<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Random Image</title>
<style>
:root {
	--safe-top: env(safe-area-inset-top);
	--safe-right: env(safe-area-inset-right);
	--safe-bottom: env(safe-area-inset-bottom);
	--safe-left: env(safe-area-inset-left);
}
html, body {
	height: 100%;
}
body {
	margin: 0;
	padding: 0;
	background: #000;
	color: #fff;
	display: grid;
	place-items: center;
	overflow: hidden;
	touch-action: manipulation; /* prevent double-tap zoom */
	-webkit-tap-highlight-color: transparent;
}
.controls {
	position: fixed;
	top: calc(var(--safe-top) + 8px);
	right: calc(var(--safe-right) + 8px);
	z-index: 4;
	font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}
.switch {
	display: inline-block;
	position: relative;
	width: 52px;
	height: 30px;
}
.switch input {
	display: none;
}
.switch .slider {
	position: absolute;
	cursor: pointer;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background: #666;
	border-radius: 999px;
	transition: background-color .2s ease;
}
.switch .slider::before {
	content: '';
	position: absolute;
	height: 24px;
	width: 24px;
	left: 3px;
	top: 3px;
	background: #fff;
	border-radius: 50%;
	transition: transform .2s ease;
}
.switch input:checked + .slider {
	background: #0a84ff;
}
.switch input:checked + .slider::before {
	transform: translateX(22px);
}
.main {
	width: calc(100vw - var(--safe-left) - var(--safe-right));
	height: calc(100vh - var(--safe-top) - var(--safe-bottom));
	display: grid;
	place-items: center;
	position: relative; /* to anchor overlay over the image area */
}
img#photo {
	width: 100%;
	height: 100%;
	object-fit: contain;
	user-select: none;
	-webkit-user-drag: none;
}

#overlay {
	position: absolute; /* overlay directly over the image container */
	left: 0;
	right: 0;
	top: 0;
	bottom: 0;
	display: none; /* toggled to grid when visible */
	place-items: center;
	background: rgba(0,0,0,0); /* ensure fully transparent */
	color: #fff;
	font-size: clamp(32px, 10vw, 96px);
	font-weight: 700;
	text-align: center;
	line-height: 1.2;
	letter-spacing: 0.5px;
	user-select: none;
	pointer-events: none; /* allow taps to pass through */
	z-index: 2; /* ensure overlay text is above the image */
}
</style>
</head>
<body>
	<div class="main">
		<img id="photo" alt="Random" src="" />
	</div>
	<div id="overlay" aria-hidden="true"></div>
	<div class="controls" title="Numbers training mode">
		<label class="switch">
			<input type="checkbox" id="modeToggle" />
			<span class="slider"></span>
		</label>
	</div>
<script>
(function() {
	const imageNames = [
		"00.png",
		"01.png",
		"02.png",
		"04.png",
		"06.png",
		"10.png",
		"11.png",
		"12.png",
		"13.png",
		"14.png",
		"15.png",
		"17.png",
		"19.png",
		"32.png",
		"33.png",
		"34.jpg",
		"46.png",
		"48.png",
		"49.jpg",
		"50.jpg",
		"55.png",
		"56.png",
		"58.png",
		"60.png",
		"61.png",
		"62.png",
		"64.png",
		"65.png",
		"68.png",
		"71.png",
		"73.png",
		"75.png",
		"76.png",
		"77.png",
		"79.png",
		"80.png",
		"81.png",
		"88.png"
	];

	const basePath = 'img/';
	const imgEl = document.getElementById('photo');
	const overlayEl = document.getElementById('overlay');
	const modeToggle = document.getElementById('modeToggle');
	const controlsEl = document.querySelector('.controls');
	let lastIndex = -1;
	let isTransitioning = false;
	let isNumberMode = false;
	let pendingIndex = null; // next number's image index in number mode
	const preloadMap = new Map();

	function preloadImage(src) {
		if (preloadMap.has(src)) return preloadMap.get(src);
		let resolveFn;
		const p = new Promise(function(resolve) { resolveFn = resolve; });
		const temp = new Image();
		function done() { resolveFn(); }
		if (typeof temp.decode === 'function') {
			temp.src = src;
			temp.decode().then(done).catch(done);
		} else {
			temp.onload = done;
			temp.onerror = done;
			temp.src = src;
		}
		preloadMap.set(src, p);
		return p;
	}

	function getBaseName(fileName) {
		return fileName.replace(/\.[^.]+$/, '');
	}

	function pickNextIndex() {
		if (imageNames.length === 1) return 0;
		let idx;
		do {
			idx = Math.floor(Math.random() * imageNames.length);
		} while (idx === lastIndex);
		lastIndex = idx;
		return idx;
	}

	function pickFreshIndex() {
		if (imageNames.length === 1) return 0;
		let idx;
		do {
			idx = Math.floor(Math.random() * imageNames.length);
		} while (idx === lastIndex);
		return idx; // does NOT mutate lastIndex
	}

	function showRandomImage() {
		const idx = pickNextIndex();
		imgEl.src = basePath + imageNames[idx];
	}

	window.addEventListener('DOMContentLoaded', showRandomImage, { once: true });

	function showNumberForIndex(idx) {
		const nameToShow = getBaseName(imageNames[idx]);
		overlayEl.textContent = nameToShow;
		overlayEl.style.color = '#000';
		overlayEl.style.background = '#fff';
		overlayEl.style.display = 'grid';
		// Preload the corresponding image while the number is visible
		const src = basePath + imageNames[idx];
		preloadImage(src);
	}

	function enterNumberMode() {
		if (isTransitioning) return;
		isNumberMode = true;
		if (pendingIndex === null) pendingIndex = pickFreshIndex();
		showNumberForIndex(pendingIndex);
	}

	function exitNumberMode() {
		isNumberMode = false;
		overlayEl.style.display = 'none';
		overlayEl.style.background = 'rgba(0,0,0,0)';
		overlayEl.style.color = '#fff';
		pendingIndex = null;
		if (lastIndex < 0) {
			showRandomImage();
		}
	}

	modeToggle.addEventListener('change', function() {
		if (modeToggle.checked) {
			enterNumberMode();
		} else {
			exitNumberMode();
		}
	});

	// Use pointer events so it works on both touch and mouse without double-firing
	window.addEventListener('pointerdown', function(ev) {
		if (ev.isPrimary === false) return; // ignore secondary pointers
		// Ignore taps on the controls (e.g., the slider)
		if (controlsEl && controlsEl.contains(ev.target)) return;
		if (isTransitioning) return;
		isTransitioning = true;

		if (isNumberMode) {
			// In number mode: currently showing a number on white background.
			if (pendingIndex === null) pendingIndex = pickFreshIndex();
			// Show its image for 0.5s, then next number.
			// Avoid flicker: keep white overlay until the image is decoded, then swap and hide overlay.
			const src = basePath + imageNames[pendingIndex];
			preloadImage(src).then(function() {
				imgEl.src = src;
				overlayEl.style.display = 'none';
				lastIndex = pendingIndex;
				setTimeout(function() {
					pendingIndex = pickFreshIndex();
					showNumberForIndex(pendingIndex);
					isTransitioning = false;
				}, 500);
			});
			return;
		}

		// Normal mode: show current image name for 0.5s, then next image
		if (lastIndex < 0) {
			showRandomImage();
			isTransitioning = false;
			return;
		}
		const currentFile = imageNames[lastIndex];
		const nameToShow = getBaseName(currentFile);
		overlayEl.textContent = nameToShow;
		overlayEl.style.color = '#fff';
		overlayEl.style.background = 'rgba(0,0,0,0)';
		overlayEl.style.display = 'grid';
		setTimeout(function() {
			overlayEl.style.display = 'none';
			showRandomImage();
			isTransitioning = false;
		}, 500);
	});
})();
</script>
</body>
</html>


